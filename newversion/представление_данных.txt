# Функции

Все функции обладают понятными именами, состоящими из:
ключевого слова, определяющего, что это функция,
название элемента или подэлемента сайта, или условную группу операций, определяющих ее отношение
название самой функции

> funcElementSubelement_Name

Примеры:
funcData_Parse
funcModuleForm_Generated

# Переменные

Есть только небольшое число разрешенных переменных:

группа ключей: $key $subkey $subsubkey $sub...key => $k $sk $ssk $s...k
группа элементов: $item $subitem $subsubitem $sub...item => $i $si $ssi $s...i
группа наименований: $object $array => $obj $arr
группа данных: $data

Все прочие переменные обладают именами, состоящими из:
ключевого слова, определяющего, что это переменная
ее отношение
ее название

> vElementName

В функциях разрешено отношение по текущей привязке, т.е. This или без привязки:

> vThisName
> vName

Примеры:
vDataString
vThisTarget
vTarget

# Массивы и объекты

Это те же переменные, строятся по тем же правилам, только ключевым словом является arr

> arrElementName
> arrThisName
> arrName

Примеры:
arrDataString
arrThisTarget
arrTarget

# Глобальные системные объекты

Их немного, все они стандартизированы, запись в них, как и их замена, может привести к ошибкам в работе системы.

Для пользователя они представляют собой источник данных.

$lang
$dictionary
$template
$router
$module
$query
$system

# Области видимости

глобальной областью видимости для системы является

> /is/

Существует системная область

> /is/system/

В ней расположены глобальные системные объекты

$template
$router
$system
$query
$lang
$dictionary

Есть также область видимости модулей, в которой работают модули

> /is/modules/

Еще одна область видимости - для контента, где расположены статьи, список статей или текущая статья

> /is/content/

Еще есть защищенная, скрытая область видимости, которая предназначена для хранения защищенных данных

> /is/secure/

И последняя область видимости - для администраторов, модераторов и прочих управляющих сайтом

> /is/administrator/

# Формат данных

Все данные хранятся в формате json, незначительно доработанном и специализированном системой.

Отличия:

разрешены отступы строк в виде пробелов и табуляций
разрешены переносы строк '\r', '\n' и '\r\n'
разрешены комментарии вида '//' до конца строки
разрешены комментарии вида '/*...*/'

Внутри данных возможно разбиение на атрибуты через двоеточие.

> "group:subgroup:item"

Такие данные будут разобраны и представлены либо в виде:

{ "group" : { "subgroup" : "item" } }

Либо в виде:

{ "type" : "group", "subtype" : "subgroup", "element" : "item" }

Такое представление данных является понятным для пользователя и весьма удобным, например, для передачи атрибутов и аргументов.

Также формат данных поддерживает текстовые переменные, вызов которых осуществляется через фигурные скобки:

> {name:attribute1:attribute2:...}

Поддерживается ограниченное число текстовых переменных. На данный момент это:

link - для вывода ссылки
lang - для вызова языковой переменной
module - для вывода модуля в контенте
page - для вызова страницы в контенте

Дело в том, что по-умолчанию ссылки через тег <a> в контенте запрещены в целях безопасности и единственной возможностью
вывода ссылок в контенте является их вызов через текстовую переменную

Планируется также ввести переменные:

router - для получения данных страницы
content - для управления контентом
date - для вывода даты

Еще было бы неплохо сделать вывод через общую функцию, которая может выводить данные переменных, форматировать их (дата, телефон)
и использовать ее как прослойку для редактирования сайта через фронтэнд

# Форматы файлов

Разрешенных форматов файлов всего два:

- php для страниц
- ini для данных

Все страницы, включая системные и страницы шаблонов, используют расширение php.

Все файлы данных имеют расширение ini.

# Формат базы данных

Все данные, которые хранятся в файлах формата ini, могут быть перенесены в базу данных.

Все данные, которые лежат в административной папке, имеют свой раздел в бд по названию и свою структуру:

> administrator/name.ini => db/name

пример файла:

	[administrator/structure.ini]
	{
		"home",
		"about" : {
			"news|article",
			"faq|article",
			"conditions|url" : "/documents/conditions/"
		},
		"documents" : {
			"conditions",
			"privacypolicy",
			"useragreement"
		},
		"contacts"
	}

пример раздела бд:

	[db/structure]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   home          null      null    null
	1   about         null      null    null
	2   news          about     article null
	3   faq           about     article null
	4   conditions    about     url     /documents/conditions/
	5   documents     null      null    null
	6   conditions    documents null    null
	7   privacypolicy documents null    null
	8   useragreement documents null    null
	9   contacts      null      null    null

Все остальные файлы имеют разделы, согласно папкам, в которых они лежат и простую структуру в формате json:

> folder/subfolder/name.ini => db/folder

пример файла:

	[templates/default/settings.ini]
	{
		"libraries" : [
			"jquery"
	...

пример раздела бд:

	[db/templates]
	id | name   | parent | type | data
	------------------------------------------------------
	0   settings default  null   {"libraries":["jquery"...

пример файла:

	[modules/articles/data/news.ini]
	{
		"page" : {
			"topdate" : 
	...

пример раздела бд:

	[db/modules]
	id | name   | parent | type | data
	----------------------------------------------------
	0   news     articles data   {"page":{"topdate":"...

пример файла:

	[languages/ru.common.ini]
	{
		"morph" : {
			"declension" : 
	...

пример раздела бд:

	[db/languages]
	id | name   | parent | type | data
	-------------------------------------------------------
	0   ru       null     common {"morph":{"declension":...







ПАПКА administrator - разбирается по особым условиям:
	[administrator/name.ini]
	[db/name]
	id | name        | parent  | type  | data
	-----------------------------------------
	... ...           ...       ...     ...

ОДИН уровень вложенности:

	[folder/name.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   name     null     null   ...

ДВА уровня вложенности:

	[folder/parent/name.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   name     parent   ...    ...
	
	[templates/default/settings.ini]
	[db/templates]
	id | name   | parent | type | data
	----------------------------------
	0   settings default  ...    ...

ТРИ уровня вложенности:

	[folder/parent/type/name.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   name     parent   type   ...

	[modules/articles/data/name.ini]
	[db/modules]
	id | name   | parent | type | data
	----------------------------------
	0   name     articles data   ...

	[folder/name/type/parent.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   name     parent   type   ...

ДВОЙНОЕ ИМЯ ФАЙЛА - назначает тип и не зависит от уровней вложенности:

	[folder/name.type.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   name     null     type   ...

	[folder/parent/name.type.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   name     parent   type   ...

	[folder/parent/another/news.type.ini]
	[db/folder]
	id | name   | parent | type | data
	----------------------------------
	0   news     parent   type   ...

ПРИМЕРЫ:

	[templates/default/settings.ini]
	[db/templates]
	id | name   | parent | type | data
	----------------------------------
	0   settings default  ...    ...

	[templates/default/seo.ini]
	[db/templates]
	id | name   | parent | type | data
	----------------------------------
	0   seo      default  ...    ...

	[templates/default/lang/ru.ini]
	[db/templates]
	id | name   | parent | type | data
	----------------------------------
	0   ru       default  lang   ...

	[templates/default/lang/ru.common.ini]
	[db/templates]
	id | name   | parent | type | data
	----------------------------------
	0   ru       default  common ...

	[modules/articles/data/news.ini]
	[db/modules]
	id | name   | parent | type | data
	----------------------------------
	0   news     articles data   ...

	[modules/articles/settings.ini]
	[db/modules]
	id | name   | parent | type | data
	----------------------------------
	0   settings articles ...    ...

	[articles/news/01.ini]
	[db/articles]
	id | name   | parent | type | data
	----------------------------------
	0   01       news     ...    ...

	[languages/ru.common.ini]
	[db/languages]
	id | name   | parent | type | data
	----------------------------------
	0   ru       ...      common ...

	[languages/ru.ini]
	[db/languages]
	id | name   | parent | type | data
	----------------------------------
	0   ru       ...      ...    ...

АДМИНИСТРАТОР:

	[administrator/structure.ini]
	{
		"home",
		"about" : {
			"news|article",
			"faq|article",
			"conditions|url" : "/documents/conditions/"
		},
		"documents" : {
			"conditions",
			"privacypolicy",
			"useragreement"
		},
		"contacts"
	}
	[db/structure]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   home          null      null    null
	1   about         null      null    null
	2   news          about     article null
	3   faq           about     article null
	4   conditions    about     url     /documents/conditions/
	5   documents     null      null    null
	6   conditions    documents null    null
	7   privacypolicy documents null    null
	8   useragreement documents null    null
	9   contacts      null      null    null

	[administrator/administrator|personal|private.ini]
	{
		"administrator",
		"langedit",
		"filemanager",
		"sitemap",
		"robots"
	}
	[db/administrator|personal|private]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   administrator null      null    null
	1   langedit      null      null    null
	2   filemanager   null      null    null
	3   sitemap       null      null    null
	4   robots        null      null    null

	[administrator/languages.ini]
	{
		"langs" : {
			"ru" : ["ru", "be", "uk", "ky", "ab", "mo", "et", "lv"],
			"en" : ["en", "de"]
		},
		"codes" : {
			"ru" : "ru_RU",
			"en" : "en_US"
		}
	}
	[db/languages]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   ru            null      langs   ["ru","be","uk","ky","ab","mo","et","lv"]
	1   en            null      langs   ["en","de"]
	2   ru            null      codes   ru_RU
	3   en            null      codes   en_US

	[administrator/functions.ini]
	[
		"custom"
	]
	[db/functions]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   custom        null      null    null

	[administrator/processor.ini]
	{
		"administrator" : ["settings", "language"],
		"user" : ["restore", "activation", "deactivation", "authorisation", "registration", "cookiesagree"],
		"forms" : ["logout", "editprofile", "changeavatar", "deleteavatar"],
		"projects" : ["createproject", "deleteproject", "openproject", "closeproject", "lockproject"],
		"editor" : ["savecard", "updatecard", "searchcard", "refreshcard", "saveboard"],
		"payment" : ["payment"]
	}
	[db/processor]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   administrator null      null    ["settings", "language"]
	1   user          null      null    ["restore", "activation", "deactivation", "authorisation", "registration", "cookiesagree"]
	2   forms         null      null    ["logout", "editprofile", "changeavatar", "deleteavatar"]
	3   projects      null      null    ["createproject", "deleteproject", "openproject", "closeproject", "lockproject"]
	4   editor        null      null    ["savecard", "updatecard", "searchcard", "refreshcard", "saveboard"]
	5   payment       null      null    ["payment"]

	[administrator/userstable.ini]
	{
		"id" : {
			"secure" : true,
			"readonly" : true
		},
		"login" : {
			"type" : "",
			"validation" : "",
			"unique" : true,
			"required" : true,
			"authorise" : true,
			"secure" : true,
			"crypt" : false,
			"readonly" : true
		},
		"password" : {
			"secure" : true,
			"crypt" : "password"
		},
		"status" : {
			"secure" : true
		},
		"data" : {
		},
		"email" : {
		},
		"phone" : {
			"type" : "numeric",
			"validation" : "email",
			"unique" : true,
			"required" : false,
			"authorise" : true,
			"secure" : false,
			"crypt" : true,
			"readonly" : false
		},
		"birthday" : {
			"type" : "date",
			"validation" : "date",
			"unique" : false,
			"required" : false,
			"authorise" : false,
			"secure" : false,
			"crypt" : false,
			"readonly" : false
		},
		"register" : {
			"type" : "date",
			"validation" : "email",
			"unique" : false,
			"required" : false,
			"authorise" : false,
			"secure" : false,
			"crypt" : false,
			"readonly" : false
		},
		"lastvisit" : {
			"type" : "date",
			"validation" : "email",
			"unique" : false,
			"required" : false,
			"authorise" : false,
			"secure" : false,
			"crypt" : false,
			"readonly" : true
		}
	}
	[db/userstable]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   id            null      null    {"secure":true,"readonly":true}
	1   login         null      null    {"type":"","validation":"","unique":true,"required":true,"authorise":true,"secure":true,"crypt":false,"readonly":true}
	2   password      null      null    {"secure":true,"crypt":"password"}
	3   status        null      null    {"secure":true}
	4   data          null      null    {}
	5   email         null      null    {}
	6   phone         null      null    {"type":"numeric","validation":"email","unique":true,"required":false,"authorise":true,"secure":false,"crypt":true,"readonly":false}
	7   birthday      null      null    {"type":"date","validation":"date","unique":false,"required":false,"authorise":false,"secure":false,"crypt":false,"readonly":false}
	8   register      null      null    {"type":"date","validation":"email","unique":false,"required":false,"authorise":false,"secure":false,"crypt":false,"readonly":false}
	9   lastvisit     null      null    {"type":"date","validation":"email","unique":false,"required":false,"authorise":false,"secure":false,"crypt":false,"readonly":true}

	[administrator/users.csv]
	id,login,password,status,register,data,email,phone,birthday,lastvisit
	1549969549005126,lirasitemaster,$2y$10$dfV6Yp8RS35Sq9Yh3gCHyeCZkAmWzyptj.PjWsR0mVhSEfzpb6u76,100,,,lirasitemaster@yandex.ru,,,
	1549969569008193,admin,$2y$10$blgS4VJypGq4QMrkFFQaZ.Btnk9ushGDa1Sit43Pp4OMnR73g1a/q,100,,,admin@mail.com,,,
	1549969619001121,user,$2y$10$ObdUWuLuFP/4rXjVCvNj8efclRi730Xaz4Tl.TB52Y/Ko2jx76uNy,,,,user@mail.com,,,
	[db/users]
	id | name           | parent  | type  | data
	----------------------------------------------------------
	0   1549969549005126 null      null    {"id":"1549969549005126","login":"lirasitemaster","password":"$2y$10$dfV6Yp8RS35Sq9Yh3gCHyeCZkAmWzyptj.PjWsR0mVhSEfzpb6u76","status":"100","register":"","data":"","email":"lirasitemaster@yandex.ru","phone":"","birthday":"","lastvisit":""}
	1   1549969569008193 null      null    {"id":"1549969569008193","login":"admin","password":"$2y$10$blgS4VJypGq4QMrkFFQaZ.Btnk9ushGDa1Sit43Pp4OMnR73g1a/q","status":"100","register":"","data":"","email":"admin@mail.com","phone":"","birthday":"","lastvisit":""}
	2   1549969619001121 null      null    {"id":"1549969619001121","login":"user","password":"$2y$10$ObdUWuLuFP/4rXjVCvNj8efclRi730Xaz4Tl.TB52Y/Ko2jx76uNy","status":"","register":"","data":"","email":"user@mail.com","phone":"","birthday":"","lastvisit":""}

	[administrator/libraries.ini]
	{
		"bootstrap" : {
			"css" : "css/bootstrap.min.css",
			"css_cdn" : "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css",
			"js" : "js/bootstrap.bundle.min.js",
			"js_cdn" : "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"
		},
		"less" : {
			"code" : "lessc.inc.php"
		},
		"datepicker" : {
			"css" : "dist/css/bootstrap-datepicker.min.css",
			"js" : "dist/js/bootstrap-datepicker.min.js",
			"js_lang" : "dist/locales/bootstrap-datepicker.{lang}.min.js"
		}
	}
	[db/libraries]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   bootstrap     null      null    {"css":"css/bootstrap.min.css","css_cdn":"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css","js":"js/bootstrap.bundle.min.js","js_cdn":"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"}
	1   less          null      null    {"code":"lessc.inc.php"}
	2   datepicker    null      null    {"css":"dist/css/bootstrap-datepicker.min.css","js":"dist/js/bootstrap-datepicker.min.js","js_lang":"dist/locales/bootstrap-datepicker.{lang}.min.js"}

	[administrator/configuration.ini]
	{
		"db" : {
			"type" : "nodb",
			"host" : "localhost",
			"user" : "root",
			"pass" : "",
			"name" : "site_db",
			"prefix" : "is"
		},		
		"name" : {
			"administrator" : "administrator",
			"articles" : "articles",
			"cache" : "cache",
			"core" : "includes",
			"install" : "install",
			"libraries" : "libraries",
			"modules" : "modules",
			"templates" : "templates",
			"public" : "media"
		},
		"path" : {
			"administrator" : "/",
			"articles" : "/",
			"cache" : "/",
			"core" : "/",
			"install" : "/",
			"libraries" : "/",
			"modules" : "/",
			"templates" : "/",
			"public" : "/"
		},
		"templates" : {
			"base" : "base",
			"default" : "default",
			"errors" : "errors",
			"restore" : "restore"
		},
		"language" : "ru",
		"secure" : "default",
		
		
	}
	[db/libraries]
	id | name        | parent  | type  | data
	----------------------------------------------------------
	0   bootstrap     null      null    {"css":"css/bootstrap.min.css","css_cdn":"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css","js":"js/bootstrap.bundle.min.js","js_cdn":"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"}
	1   less          null      null    {"code":"lessc.inc.php"}
	2   datepicker    null      null    {"css":"dist/css/bootstrap-datepicker.min.css","js":"dist/js/bootstrap-datepicker.min.js","js_lang":"dist/locales/bootstrap-datepicker.{lang}.min.js"}

# Проверка

Проверка существования данных или положительного результата осуществляется через функцию dataset(), которая проверяет присутствие данных и возвращает true/false.

Она заменяет в большинстве случаев вызов isset() и !empty(), плюс многочисленные проверки вида:

if (empty($x) || $x === 0 || $x === '0')
if (!empty($x) && is_array($x) && reset($x))

и так далее. Подробнее см. в описании функции.

Вызов:

> if (dataset($x))

Проверка данных на соответствие массиву осуществляется через функцию dataarray().

Она заменяет в большинстве случаев проверки и конвертации вида:

if (is_array($x) || is_object($x))
if (is_object($x)) { $x = (array) $x; }

Вызов:

> if (dataarray($x))
> if (dataarray($x)) { $x = > dataarray($x, true); }






